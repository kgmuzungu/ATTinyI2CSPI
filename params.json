{"name":"Attinyi2cspi","tagline":"Thermometer, ATTiny85, MAX31855, thermocoupler, LCD HD44780 display with PFC8574, Arduino IDE 1.6.6","body":"# ATTinyI2CSPI\r\nThermometer, ATTiny85 MAX31855 with thermocoupler, LCD HD44780 display with PFC8574, Arduino IDE 1.6.6\r\n\r\nThe challenge is to get the ATTiny talk I2C to the PFC8574 port expander that is connected to the LCD display and SPI to the MAX31855. Plenty of code is out there let's just put it together. \r\n\r\nGeneral: the MAX31855 (from Adafruit: https://www.adafruit.com/product/269, https://www.maximintegrated.com/en/products/analog/sensors-and-sensor-interface/MAX31855.html) is an amplifier for also K-type thermocouplers (K-type = defines the two metals used to sense temp). About how to measure temperature you find in Maxim Application notes. K-type thermocouplers are non-linear and are not compensated by the MAX31855. But for temperature ranges from -50 to 300C you can live without compensation. You can figure out the accuracy of this implementation yourself (depends also on the thermocoupler you used). You could do some compensation using the ATTiny (but you might have to optimize the used libraries to free up some memory)\r\n\r\nComponents used:\r\n- ATTiny85\r\n- MAX31855\r\n- LCD HD44780 display with PFC8574\r\n- Arduino Uno for programming the ATTiny\r\n\r\nGreat thanks for the fantastic libraries I could use:\r\n- by F Malpartida:  NewLiquidCrystal https://bitbucket.org/fmalpartida/new-liquidcrystal/wiki/Home\r\n- optional: by J Christensen: TinySPI https://github.com/JChristensen/tinySPI\r\n- by Limor Fried/Ladyada: Adafruit_MAX31855 (modified) https://github.com/adafruit/Adafruit-MAX31855-library\r\n\r\nWiring:  \r\n``` \r\nthe pin numbers outside the box are the IDE pin numbers. Inside the box are the chip pin numbers.\r\n                         ATTiny85\r\n                         +-----+\r\n                RESET -5-|1   8|--- Vcc\r\n..to\t      { SCL   -3-|2   7|-2- CLK = CLOCK_PIN }\r\nPCF8574\t      { SDA   -4-|3   6|-1- CS\t= LATCH_PIN\t} ..to Adafruit MAX31855\r\n                GND   ---|4   5|-0- DO\t= DATA_PIN  }\r\n                         +-----+\r\n```\t\t\t   \r\n\r\n\r\nSetting up the Arduino IDE:\r\nOpen the sketch ArduinoISP in examples and upload it to the Arduino Uno. Connect the ATTiny85 as in\r\nhttp://highlowtech.org/?p=1695\r\nhttp://highlowtech.org/?p=1706\r\n\r\nThen go to\r\ntools --> board\t-->ATTiny\r\n\r\ntools --> processor-->ATTiny85\r\n\r\ntools --> clock\t-->8MHz(internal)\r\n\r\ntools --> programmer-->Arduino as ISP\r\n\r\nIf you have a vergin ATTiny85 you have to burn the bootloader first.\r\n\r\nGet the display working using NewLiquidCrystal:\r\nThe ATTiny has no I2C hardware. Therefore we will use LiquidCrystal_SI2C.h, the SoftwareI2C. Copy the unpacked NewLiquidCrystal into %USER%\\Documents\\Arduino\\libraries\\NewliquidCrystal. But there is a catch. To get it all compiled you have to delete LiquidCrystal_I2C* and some other files, because all C files in the ...\\libraries\\ folder will be compiled. With the Arduino IDE set to board --> ATTiny some values are passed to the compiler that select the right constants/register settings in Arduino.h If you leave the LiquidCrystal_I2C in the ...\\libraries\\ folder you will get an error because it tries to incorporate Wire.h . ATTiny doesnt have the registers used by that library. \r\n\r\nGet the SPI communication to the MAX31855 working:\r\nThe ATTiny has no SPI hardware either but it has an USI. In Adafruit_MAX31855.cpp include tinySPI.h instead of SPI.h or you delete all hardwareSPI related code. I actually only used the softwareSPI in Adafruit_MAX31855 and that worked like a treat. Adafruit_MAX31855.cpp and Adafruit_MAX31855.h you can put in the same directory as your ATTinyThermoAndLCD.ino sketch.\r\n\r\nTo get the I2C address of your expander use https://github.com/MartyMacGyver/Arduino_I2C_Scanner/blob/master/I2C_Scanner/I2C_Scanner.ino\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}